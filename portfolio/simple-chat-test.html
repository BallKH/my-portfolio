<!DOCTYPE html>
<html>
<head>
    <title>Simple Chat Test</title>
</head>
<body>
    <h1>Simple Chat Test</h1>
    
    <div>
        <input type="text" id="nameInput" placeholder="Enter your name">
        <button onclick="setName()">Set Name</button>
    </div>
    
    <div>
        <input type="text" id="messageInput" placeholder="Enter message">
        <button onclick="sendTestMessage()">Send Test</button>
    </div>
    
    <div id="result"></div>

    <script>
        let visitorName = null;
        let sessionId = null;

        function setName() {
            const name = document.getElementById('nameInput').value.trim();
            if (!name) return;
            
            visitorName = name;
            sessionId = `session_${name.toLowerCase()}`;
            
            document.getElementById('result').innerHTML = `Name: ${visitorName}<br>Session: ${sessionId}`;
        }

        async function sendTestMessage() {
            const message = document.getElementById('messageInput').value.trim();
            if (!message || !sessionId) return;
            
            console.log('Sending:', { message, sessionId, visitorName });
            
            try {
                const response = await fetch('/api/sendMessage', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ 
                        message: message,
                        sessionId: sessionId,
                        visitorName: visitorName
                    })
                });
                
                const result = await response.json();
                console.log('Response:', result);
                
                document.getElementById('result').innerHTML += `<br>Sent: ${message}<br>Response: ${JSON.stringify(result)}`;
            } catch (error) {
                console.error('Error:', error);
                document.getElementById('result').innerHTML += `<br>Error: ${error.message}`;
            }
        }
    </script>
</body>
</html>